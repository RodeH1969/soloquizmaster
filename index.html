<!DOCTYPE html>
<html>
<head>
  <title>Speech to Text Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2vmin;
      text-align: center;
      background: #f9f9f9;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      overflow: hidden;
    }
    button {
      font-size: 4vmin;
      padding: 2vmin 4vmin;
      margin: 2vmin;
      cursor: pointer;
      border-radius: 5px;
    }
    #logo {
      max-width: 40vmin;
      margin-bottom: 2vmin;
    }
    #question {
      font-size: 5vmin; /* Larger for mobile readability */
      margin: 2vmin 0;
      font-weight: bold;
    }
    #timer img {
      width: 5vmin;
      vertical-align: middle;
      margin-right: 1vmin;
    }
    #timer {
      font-size: 4vmin;
    }
    #results {
      font-size: 3.5vmin;
      margin-top: 2vmin;
      flex-grow: 1;
      overflow: hidden;
    }
    .feedback img {
      width: 4vmin;
      height: auto;
      vertical-align: middle;
    }
    textarea {
      width: 90%;
      height: 30vmin;
      margin-top: 2vmin;
      font-size: 3vmin;
      font-family: monospace;
      resize: none;
    }
    h1 {
      font-size: 4vmin;
      margin: 1vmin 0;
    }
    p {
      font-size: 3.5vmin;
      margin: 1vmin 0;
    }
    @media (max-width: 600px) {
      #question {
        font-size: 6vmin; /* Even larger on small screens */
      }
      button {
        font-size: 5vmin;
        padding: 3vmin 5vmin;
      }
      #results {
        font-size: 4vmin;
      }
      textarea {
        font-size: 3.5vmin;
      }
    }
  </style>
</head>
<body>
  <img id="logo" src="logo.png" alt="Quiz Logo">
  <h1>Friday 11 July SoloQuiz #1</h1>
  <p><strong>10 questions, 10 seconds each to answer.</strong><br>Speak clearly and loudly into your phone. Give 1 complete answer (no other speech).</p>
  <button onclick="startQuiz()">Start Quiz</button>
  <div id="question"></div>
  <div id="timer"></div>
  <div id="results"></div>

  <script>
    const questions = [
      "In the famous play, who dies from poisoning, Romeo or Juliet?",
      "What is both a small clam and a chamber of the heart?",
      "Beginning with 'N', who was the Greek goddess of retribution?",
      "How many private cards in Texas Holdem poker?",
      "What in 2009 was the only flu pandemic of the 21st century?",
      "What two colours adorned the traditional Mr Whippy van?",
      "According to legend, who did Peeping Tom spy on?",
      "India is named after which river?",
      "What is the Great Star of Africa?",
      "In which ocean is Reunion Island?"
    ];

    const acceptableAnswers = [
      ["romeo"],
      ["cockle"],
      ["nemesis"],
      ["two", "2"],
      ["swine flu", "swine"],
      ["pink and white", "white and pink"],
      ["lady godiva", "godiva"],
      ["indus river", "indus"],
      ["a diamond", "diamond"],
      ["indian ocean"]
    ];

    const numberToWord = {
      "1": "one",
      "2": "two",
      "3": "three",
      "4": "four",
      "5": "five",
      "6": "six",
      "7": "seven",
      "8": "eight",
      "9": "nine",
      "10": "ten"
    };

    let current = 0;
    let userAnswers = [];
    let isProcessing = false;

    function startQuiz() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Speech recognition is not supported in this browser. Please use Chrome or a compatible browser.");
        return;
      }
      document.querySelector('button').style.display = 'none';
      nextQuestion();
    }

    function nextQuestion() {
      if (current >= questions.length) {
        displayResults();
        return;
      }

      document.getElementById('question').innerText = questions[current];

      let timeLeft = 10;
      let timerRunning = true;
      document.getElementById('timer').innerHTML = `<img src="stopwatch.png"> ${timeLeft}s`;

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerHTML = `<img src="stopwatch.png"> ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerRunning = false;
          recognition.stop();
          proceedToNextQuestion();
        }
      }, 1000);

      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript.trim().toLowerCase();
        userAnswers[current] = spoken;
      };

      recognition.onerror = function() {
        userAnswers[current] = "";
      };

      recognition.onend = () => {
        if (timerRunning) {
          recognition.start();
        } else if (!isProcessing) {
          proceedToNextQuestion();
        }
      };

      recognition.start();

      function proceedToNextQuestion() {
        if (isProcessing) return;
        isProcessing = true;
        clearInterval(timerInterval);
        document.getElementById('timer').innerHTML = '';
        userAnswers[current] = userAnswers[current] || "";
        current++;
        setTimeout(() => {
          isProcessing = false;
          nextQuestion();
        }, 1000);
      }
    }

    function displayResults() {
      let resultsHTML = "<h2>Results:</h2><ul style='list-style:none; padding-left:0;'>";
      let totalScore = 0;

      for (let i = 0; i < Math.min(userAnswers.length, acceptableAnswers.length); i++) {
        let ans = userAnswers[i] || "";
        let normalizedUser = ans.toLowerCase();
        if (numberToWord[normalizedUser]) {
          normalizedUser = numberToWord[normalizedUser];
        }
        const correctOptions = acceptableAnswers[i] || ["(no answer)"];
        const isCorrect = correctOptions.some(opt => normalizedUser.includes(opt) || opt.includes(normalizedUser)) && ans !== "";
        if (isCorrect) totalScore++;
        const feedbackImg = isCorrect ? "correct.png" : "incorrect.png";
        resultsHTML += `<li><strong>Q${i + 1}</strong>: You said \"${ans || "(no answer)"}\"<br>` +
          `Correct: \"${correctOptions[0]}\"<br>` +
          `<span class='feedback'><img src="${feedbackImg}" onerror="this.src='https://via.placeholder.com/20?text=X'" alt="${isCorrect ? 'Correct' : 'Incorrect'}"> ${isCorrect ? "Correct" : "Incorrect"}</span></li><br>`;
      }

      let smsContent = "SoloQuiz #1\nFriday 11 July\n";
      for (let i = 0; i < Math.min(userAnswers.length, acceptableAnswers.length); i++) {
        let ans = userAnswers[i] || "";
        let normalizedUser = ans.toLowerCase();
        if (numberToWord[normalizedUser]) {
          normalizedUser = numberToWord[normalizedUser];
        }
        const correctOptions = acceptableAnswers[i] || ["(no answer)"];
        const isCorrect = correctOptions.some(opt => normalizedUser.includes(opt) || opt.includes(normalizedUser)) && ans !== "";
        smsContent += `${i + 1}. ${isCorrect ? "correct" : "incorrect"}\n`;
      }
      smsContent += `Total Score: ${totalScore}/10`;

      resultsHTML += `<p>Copy the results below to share via SMS:</p><textarea readonly id="resultsText">${smsContent}</textarea>`;
      resultsHTML += `<br><button onclick="copyResults(event)">Share Results</button>`;

      resultsHTML += "</ul>";
      document.getElementById('question').innerHTML = "";
      document.getElementById('timer').innerHTML = "";
      document.getElementById('results').innerHTML = resultsHTML;
    }

    function copyResults(event) {
      event.preventDefault(); // Prevent default browser share behavior
      const resultsText = document.getElementById('resultsText').value;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(resultsText).then(() => {
          alert("Results copied to clipboard!");
        }).catch(() => {
          alert("Failed to copy results. Please select and copy the text manually.");
        });
      } else {
        alert("Clipboard API not supported. Please select and copy the text manually.");
      }
    }
  </script>
</body>
</html>