<!DOCTYPE html>
<html>
<head>
  <title>Speech to Text Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; text-align: center; background: #f9f9f9; }
    button { font-size: 1.2em; padding: 0.5em 1em; margin: 0.5em; cursor: pointer; }
    #result { margin-top: 2em; font-size: 1.4em; }
    #logo { max-width: 250px; margin-bottom: 1em; }
    #question { font-size: 1.8em; margin-top: 1em; }
    #timer img { width: 24px; vertical-align: middle; margin-right: 0.5em; }
    .feedback img { width: 20px; height: auto; vertical-align: middle; }
    textarea { width: 80%; height: 200px; margin-top: 1em; font-size: 1em; font-family: monospace; }
  </style>
</head>
<body>
  <img id="logo" src="logo.png" alt="Quiz Logo">
  <h1>Friday 11 July SoloQuiz #1</h1>
  <p><strong>10 questions, 10 seconds each to answer.</strong><br>Speak clearly and loudly into your phone. Give 1 complete answer (no other speech).</p>
  <button onclick="startQuiz()">Start Quiz</button>
  <div id="question"></div>
  <div id="timer"></div>
  <div id="results"></div>

  <script>
    const questions = [
      "In the famous play, who dies from poisoning, Romeo or Juliet?",
      "What is both a small clam and a chamber of the heart?",
      "Beginning with 'N', who was the Greek goddess of retribution?",
      "How many private cards in Texas Holdem poker?",
      "What in 2009 was the only flu pandemic of the 21st century?",
      "What two colours adorned the traditional Mr Whippy van?",
      "According to legend, who did Peeping Tom spy on?",
      "India is named after which river?",
      "What is the Great Star of Africa?",
      "In which ocean is Reunion Island?"
    ];

    const acceptableAnswers = [
      ["romeo"],
      ["cockle"],
      ["nemesis"],
      ["two", "2"],
      ["swine flu", "swine"],
      ["pink and white", "white and pink"],
      ["lady godiva", "godiva"],
      ["indus river", "indus"],
      ["a diamond", "diamond"],
      ["indian ocean"]
    ];

    const numberToWord = {
      "1": "one",
      "2": "two",
      "3": "three",
      "4": "four",
      "5": "five",
      "6": "six",
      "7": "seven",
      "8": "eight",
      "9": "nine",
      "10": "ten"
    };

    let current = 0;
    let userAnswers = [];
    let isProcessing = false;

    function startQuiz() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Speech recognition is not supported in this browser. Please use Chrome or a compatible browser.");
        return;
      }
      document.querySelector('button').style.display = 'none';
      nextQuestion();
    }

    function nextQuestion() {
      if (current >= questions.length) {
        displayResults();
        return;
      }

      document.getElementById('question').innerText = questions[current];

      let timeLeft = 10;
      let timerRunning = true;
      document.getElementById('timer').innerHTML = `<img src="stopwatch.png"> ${timeLeft}s`;

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerHTML = `<img src="stopwatch.png"> ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerRunning = false;
          recognition.stop();
          proceedToNextQuestion();
        }
      }, 1000);

      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript.trim().toLowerCase();
        userAnswers[current] = spoken;
      };

      recognition.onerror = function() {
        userAnswers[current] = "";
      };

      recognition.onend = () => {
        if (timerRunning) {
          recognition.start();
        } else if (!isProcessing) {
          proceedToNextQuestion();
        }
      };

      recognition.start();

      function proceedToNextQuestion() {
        if (isProcessing) return;
        isProcessing = true;
        clearInterval(timerInterval);
        document.getElementById('timer').innerHTML = '';
        userAnswers[current] = userAnswers[current] || "";
        current++;
        setTimeout(() => {
          isProcessing = false;
          nextQuestion();
        }, 1000);
      }
    }

    function displayResults() {
      let resultsHTML = "<h2>Results:</h2><ul style='list-style:none; padding-left:0;'>";
      let totalScore = 0;

      // Generate HTML results and calculate score
      for (let i = 0; i < Math.min(userAnswers.length, acceptableAnswers.length); i++) {
        let ans = userAnswers[i] || "";
        let normalizedUser = ans.toLowerCase();
        if (numberToWord[normalizedUser]) {
          normalizedUser = numberToWord[normalizedUser];
        }
        const correctOptions = acceptableAnswers[i] || ["(no answer)"];
        const isCorrect = correctOptions.some(opt => normalizedUser.includes(opt) || opt.includes(normalizedUser)) && ans !== "";
        if (isCorrect) totalScore++;
        const feedbackImg = isCorrect ? "correct.png" : "incorrect.png";
        resultsHTML += `<li><strong>Q${i + 1}</strong>: You said \"${ans || "(no answer)"}\"<br>` +
          `Correct: \"${correctOptions[0]}\"<br>` +
          `<span class='feedback'><img src="${feedbackImg}" onerror="this.src='https://via.placeholder.com/20?text=X'" alt="${isCorrect ? 'Correct' : 'Incorrect'}"> ${isCorrect ? "Correct" : "Incorrect"}</span></li><br>`;
      }

      // Generate shareable text for SMS
      let smsContent = "SoloQuiz #1\nFriday 11 July\n";
      for (let i = 0; i < Math.min(userAnswers.length, acceptableAnswers.length); i++) {
        let ans = userAnswers[i] || "";
        let normalizedUser = ans.toLowerCase();
        if (numberToWord[normalizedUser]) {
          normalizedUser = numberToWord[normalizedUser];
        }
        const correctOptions = acceptableAnswers[i] || ["(no answer)"];
        const isCorrect = correctOptions.some(opt => normalizedUser.includes(opt) || opt.includes(normalizedUser)) && ans !== "";
        smsContent += `${i + 1}. ${isCorrect ? "correct" : "incorrect"}\n`;
      }
      smsContent += `Total Score: ${totalScore}/10`;

      // Add textarea and share button
      resultsHTML += `<p>Copy the results below to share via SMS:</p><textarea readonly id="resultsText">${smsContent}</textarea>`;
      resultsHTML += `<br><button onclick="copyResults()">Share Results</button>`;

      resultsHTML += "</ul>";
      document.getElementById('question').innerHTML = "";
      document.getElementById('timer').innerHTML = "";
      document.getElementById('results').innerHTML = resultsHTML;
    }

    function copyResults() {
      const resultsText = document.getElementById('resultsText').value;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(resultsText).then(() => {
          alert("Results copied to clipboard!");
        }).catch(() => {
          alert("Failed to copy results. Please select and copy the text manually.");
        });
      } else {
        alert("Clipboard API not supported. Please select and copy the text manually.");
      }
    }
  </script>
</body>
</html>